;(function(win){if(win.VivoGame){return}function _createMsgIframe(){_msgIframe=document.createElement('iframe');_msgIframe.style.display='none';document.documentElement.appendChild(_msgIframe)}function _sendMsg(msg,action){_sendMsgQueue.push({msg:msg,action:action});if(_sendMsgQueueRunning){return}_continueSendMsg()}function _continueSendMsg(){var pendingMsg=_sendMsgQueue.shift();if(pendingMsg===undefined){_sendMsgQueueRunning=false}else{_sendMsgQueueRunning=true;var msg=pendingMsg.msg;var action=pendingMsg.action;var funName=msg.funName;var params=msg.params;var callbackID=msg.callbackID;_msgIframe.src=_CUSTOM_PROTOCOL_SCHEME+'://'+_CUSTOM_ACTION_MAP[action]+'/'+funName+'?callback='+encodeURIComponent(callbackID)+'&data='+encodeURIComponent(JSON.stringify(params))}}function _handleMessageFromNative(data){var msg;var callbackFn;var callbackID;try{msg=JSON.parse(data)||{}}catch(e){msg={}}callbackID=msg.handlerjsName;if(msg.msgtype==='request'){callbackFn=_regist_map[callbackID]}else if(msg.msgtype==='response'){callbackFn=_callback_map[callbackID];if(callbackID in _callback_map){delete _callback_map[callbackID]}}if(typeof callbackFn==='function'){callbackFn(msg.requestdata,msg.responsecallback)}}function _call(name,params,callback,action){if(!name||typeof name!=='string'){return}if(!params||typeof params!=='object'){params={}}var callbackID=String(_callback_count++);var msg;if(typeof callback==='function'){_callback_map[callbackID]=callback}msg={'funName':name,'params':params,'callbackID':callbackID};_sendMsg(msg,action)}function _callNormal(name,params,callback){if(typeof params==='function'&&callback==undefined){_call(name,{},params,'call')}else{_call(name,params,callback,'call')}}var _msgIframe;var _sendMsgQueue=[];var _sendMsgQueueRunning=false;var _callback_count=1000;var _callback_map={};var _regist_map={};var _CUSTOM_PROTOCOL_SCHEME='jsBridge';var _CUSTOM_ACTION_CALL='javacall';var _CUSTOM_ACTION_RESULT='javaresponse';var _CUSTOM_ACTION_MAP={'call':_CUSTOM_ACTION_CALL,'result':_CUSTOM_ACTION_RESULT};win.VivoGame={call:_callNormal};win.WeiwoJSBridge={_continueSendMsg:_continueSendMsg,_handleMessageFromNative:_handleMessageFromNative};_createMsgIframe()})(window);
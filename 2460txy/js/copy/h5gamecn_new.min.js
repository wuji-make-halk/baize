var h5gamecn = function() {
    var MESSAGES = {
        SHOWRECHARGE: "msg_3",
        GETORDERNO: "msg_5",
        RETURNORDERNO: "mgs_6",
        RECHARGE_CALLBACK: "msg_7",
        INIT: "msg_8",
        SET_SHARE: "msg_9",
        SHOWQRCODE: "msg_10",
        RETURN_FOCUSSTATE: "msg_12",
        SHARE_CALLBACK: "msg_13",
        REPORTDATA: "msg_14",
        SENDTODESKTOP: "msg_15",
        SENDTODESKTOP_CALLBACK: "msg_16",
        QQBROSER_LOGOUT: "msg_17",
        QQBROSER_TOPIC: "msg_18",
        SPECIALSHARE: "special_0",
        FOCUS_GETSTATE: "msg_20",
        FOCUS_RETURNSTATE: "msg_21",
        RECHARGE_PAY: "msg_22",
        CHECKSHARE: "msg_23",
        RETURNSHARE: "msg_24",
        SPECIAL_GETLOGINTYPES: "special_getlogintypes",
        INIT_CALLBACK: "msg_25",
        ON_LOGINERROR: "msg_26"
    };
    var passType;
    var passId;
    var appid = "";
    var shareInfo;
    var rechargeItems;
    var citem;
    var gameId;
    var itemId;
    var itemName;
    var isListenerInited = false;
    var gameFrame;
    var reyunAppId = "haiweiys18888s72";
    var reyunUrl = "http://www.gank-studio.com";
    var passHost;
    var ifFocused;
    var pf;
    var pfsdk;
    var pf_params = {};
    var login_params = {};
    var UA = navigator.userAgent;
    var isAndroid = (UA.indexOf("Android") > -1);
    var server_id;
    var getParameter = function(key) {
        var href = location.search;
        var p = href.substr(1, href.length - 1).split("&");
        for (var i = 0; i < p.length; i++) {
            if ((p[i].split("="))[0] == key) {
                return p[i].split("=")[1]
            }
        }
    };
    var getScreenInfo = function() {
        var fHeight = window.frameHeight;
        var fWidth = (frameWidth > frameHeight ? frameHeight * 0.6 : frameWidth);
        console.log(fWidth);
        return "&frameHeight=" + fHeight + "&frameWidth=" + fWidth
    };
    var getParameters = function() {
        var href = location.search;
        var param = {};
        if (!href.length) {
            return param
        }
        var p = href.substr(1, href.length - 1).split("&");
        for (var i = 0; i < p.length; i++) {
            param[(p[i].split("="))[0]] = p[i].split("=")[1]
        }
        return param
    };
    var getPassId = function() {
        return getParameter("passIds")
    };
    var createIframe = function(src, id, tgt) {
        var ifm = document.createElement("iframe");
        ifm.scrolling = "no";
        debugtolog(document.getElementById("recharge").getAttribute("style"));
        ifm.style.width = Math.ceil(frameWidth > frameHeight ? frameHeight * 0.6 : frameWidth) + "px";
        ifm.style.height = (window.frameHeight || window.innerHeight) + "px";
        ifm.style.margin = "auto";
        ifm.style.position = "absolute";
        ifm.style.top = "0";
        ifm.style.left = "0";
        ifm.style.backgroundColor = "white";
        ifm.id = id;
        ifm.frameborder = "no";
        ifm.style.border = "none";
        ifm.border = "0px";
        ifm.style.zIndex = 99;
        (tgt || (document.body)).appendChild(ifm);
        ifm.src = src;
        return ifm
    };
    var object2search = function(param) {
        if (typeof param != "object") {
            console.error("参数不合法");
            return
        }
        var search = "?";
        var keys = Object.keys(param);
        for (var i = 0; i < keys.length; i++) {
            if (i == 0) {
                search += (keys[i] + "=" + param[keys[i]])
            } else {
                search += "&" + (keys[i] + "=" + param[keys[i]])
            }
        }
        return search
    };
    var getSearch = function() {
        return location.search
    };
    var setStorange = function(key, value) {
        localStorage.setItem(key, value)
    };
    var getStorange = function(key) {
        localStorage.getItem(key)
    };
    var gameJumpTo = function(url) {
        top.window.location.href = url
    };
    var postMessage = function(msg, d) {
        var data = {};
        data.identify = "h5gamecn";
        data.msg = msg;
        data.data = d;
        gameFrame.contentWindow.postMessage(data, "*")
    };
    var getDataXHR = function(url, cb, param, contenttype) {
        var param = param || {};
        var type = param.type || "get";
        var data = param.data || null;
        try {
            var xhr = new XMLHttpRequest();
            xhr.open(type, url, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4) {
                    var responseData = JSON.parse(xhr.responseText);
                    if (responseData.c < 0) {
                        toastMsg(responseData.msg);
                        return
                    }
                    if (xhr.responseText == "error") {
                        alert("请求" + url + "返回error");
                        return
                    }
                    if (!responseData.c && responseData.c != 0) {
                        cb && cb(responseData);
                        return
                    }
                    var data = JSON.parse(responseData.data);
                    cb && cb(data)
                }
            };
            if (contenttype) {
                try {
                    xhr.setRequestHeader("Content-Type", contenttype)
                } catch (e) {
                    alert(e)
                }
            }
            xhr.send(data)
        } catch (e) {
            console.error("xhr出错", e);
            return false
        }
    };
    var toastMsg = function(msg, delay) {
        var div = document.createElement("div");
        div.id = "toast";
        div.style.width = "260px";
        div.style.height = "130px";
        div.style.margin = "auto";
        div.style.fontSize = "16px";
        div.style.position = "absolute";
        div.style.top = "0";
        div.style.bottom = "0";
        div.style.right = "0";
        div.style.left = "0";
        div.style.zIndex = "999";
        var text = document.createElement("div");
        text.innerText = msg;
        text.style.margin = "auto";
        text.style.position = "absolute";
        text.style.top = "0";
        text.style.bottom = "0";
        text.style.right = "0";
        text.style.left = "0";
        text.style.width = "250px";
        div.appendChild(text);
        div.classList.add("toast");
        var node = (document.getElementById("recharge") && document.getElementById("recharge").style.display == "block") ? document.getElementById("recharge") : document.body;
        node.appendChild(div);
        setTimeout(function() {
            node.removeChild(div)
        }, delay || 2000)
    };
    var showConfirm = function(msg, cb, cancelcb) {
        if (document.getElementById("confirm")) {
            document.body.removeChild(document.getElementById("confirm"))
        }
        var div = document.createElement("div");
        var node = (document.getElementById("recharge") && document.getElementById("recharge").style.display == "block") ? document.getElementById("recharge") : document.body;
        div.id = "confirm";
        div.style.width = "270px";
        div.style.height = "160px";
        div.style.position = "absolute";
        div.style.margin = "auto";
        div.style.top = "30%";
        div.style.left = 0;
        div.style.right = 0;
        div.style.zIndex = "999";
        div.style.fontSize = "16px";
        div.innerText = msg;
        div.classList.add("toast");
        var button = document.createElement("button");
        button.style.position = "absolute";
        button.style.left = "40px";
        button.style.top = "120px";
        button.innerText = "确定";
        button.style.height = "30px";
        button.classList.add("button");
        button.classList.add("blue");
        button.onclick = function() {
            node.removeChild(div);
            cb && cb()
        };
        var button2 = document.createElement("button");
        button2.style.top = "120px";
        button2.style.position = "absolute";
        button2.style.right = "40px";
        button2.innerText = "取消";
        button2.style.height = "30px";
        button2.classList.add("button");
        button2.classList.add("blue");
        button2.onclick = function() {
            node.removeChild(div);
            cancelcb && cancelcb()
        };
        div.appendChild(button);
        div.appendChild(button2);
        node.appendChild(div)
    };
    var showRecharge = function(items) {
        rechargeItems = items;
        document.getElementById("recharge").style.display = "block";
        for (var i = 0; i < items.length; i++) {
            _setItem(items[i], i)
        }
    };
    var _setItem = function(data, index) {
        var div = document.createElement("div");
        var icon = document.createElement("img");
        icon.src = data.icon;
        icon.style.margin = "auto";
        icon.style.left = "10px";
        icon.style.top = "0";
        icon.style.bottom = "0";
        icon.style.position = "absolute";
        var title = document.createElement("div");
        title.style.top = "10px";
        title.style.position = "absolute";
        title.style.margin = "auto";
        title.style.right = "0";
        title.style.left = "0";
        title.innerText = data.itemName;
        var desc = document.createElement("div");
        desc.style.bottom = "20px";
        desc.style.position = "absolute";
        desc.style.margin = "auto";
        desc.style.right = "0";
        desc.style.left = "0";
        desc.innerText = data.desc;
        var button = document.createElement("div");
        button.style.top = "0";
        button.style.bottom = "0";
        button.style.position = "absolute";
        button.style.margin = "auto";
        button.style.right = "2px";
        button.innerText = "购买";
        button.classList.add("buybtn");
        button.onclick = function() {
            document.getElementById("loading").style.display = "block";
            itemId = data.id;
            itemName = data.itemName;
            cindex = index;
            postMessage(MESSAGES.GETORDERNO, {
                amount: data.amount,
                id: data.id
            })
        };
        div.appendChild(icon);
        div.appendChild(title);
        div.appendChild(desc);
        div.appendChild(button);
        div.classList.add("payItem");
        document.getElementById("items").appendChild(div)
    };
    var getcitem = function() {
        return rechargeItems[citem]
    };
    var initMessageListener = function() {
        console.info("init listener");
        window.addEventListener("message", function(e) {
            var msg = e.data;
            debugtolog(msg.msg + "  " + JSON.stringify(msg.data));
            if (msg.identify && msg.identify == "h5gamecn") {
                switch (msg.msg) {
                    case MESSAGES.INIT:
                        init(msg.data);
                        break;
                    case MESSAGES.SHOWRECHARGE:
                        showRecharge(msg.data);
                        break;
                    case MESSAGES.RETURNORDERNO:
                        var orderData = msg.data.orderData;
                        var amount = msg.data.amount;
                        try {
                            pay(amount, orderData)
                        } catch (e) {
                            alert(e)
                        }
                        break;
                    case MESSAGES.SET_SHARE:
                        setShareInfo(msg.data);
                        break;
                    case MESSAGES.SHOWQRCODE:
                        showQrCode();
                        break;
                    case MESSAGES.REPORTDATA:
                        reportData(msg.data);
                        break;
                    case MESSAGES.SENDTODESKTOP:
                        sendToDesktop();
                        break;
                    case MESSAGES.QQBROSER_LOGOUT:
                        qqBorwserLogout(msg.data);
                        break;
                    case MESSAGES.QQBROSER_TOPIC:
                        openTopicCircle();
                        break;
                    case MESSAGES.SPECIALSHARE:
                        setSpecialShare(msg.data);
                        break;
                    case MESSAGES.FOCUS_GETSTATE:
                        checkFocus(msg.data);
                        break;
                    case MESSAGES.RECHARGE_PAY:
                        pay(msg.data.amount, msg.data.orderData);
                        break;
                    case "qblogout":
                        qqBorwserLogout();
                        break;
                    case MESSAGES.CHECKSHARE:
                        isOpenShare();
                        break;
                    case MESSAGES.SPECIAL_GETLOGINTYPES:
                        if (window.showLogout) {
                            postMessage(MESSAGES.SPECIAL_GETLOGINTYPES, true)
                        }
                        break;
                    case MESSAGES.ON_LOGINERROR:
                        onLoginError(msg.data);
                        break
                }
            }
            if (e.data == "shareok") {
                console.log("群黑分享成功");
                postMessage(MESSAGES.SHARE_CALLBACK, true)
            }
        })
    };

    function loadScript(url, callback) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.onload = function() {
            callback()
        };
        script.onerror = function() {
            script.parentNode.removeChild(script);
            setTimeout(function() {
                loadScript(url, callback)
            }, 1000)
        };
        script.src = url;
        document.getElementsByTagName("head")[0].appendChild(script)
    }
    var checkLogin = function(res, cb) {
        var passIds = getParameter("passIds");
        if (passIds && passIds.split(",").length <= 1) {
            cb && cb(1);
            login(res)
        } else {
            cb && cb(2)
        }
    };
    var login = function(res, cb) {
        var passId = (res && res.passId) || getPassId();
        var appId = (res && res.appId) || getParameter("appId");
        var url = "jdk/login/" + passId + "/" + appId;
        try {
            setStorange("screenInfo", getScreenInfo());
            setStorange("appId", appId);
            setStorange("passId", passId)
        } catch (e) {
            debugtolog(e)
        }
        pf_params = res;
        url = url + object2search(res);
        debugtolog(url);
        getDataXHR(url, function(t) {
            var data = t;
            if (data.redirect) {
                document.getElementById("gameDiv").style.display = "block";
                if (data.redirect && ((data.redirect) == "http://union.11h5.com/login.html?gameid=123")) {
                    top.location.href = data.redirect;
                    return
                }
                gameFrame = createIframe(data.redirect + getScreenInfo(), "gameFrame", document.getElementById("gameDiv"));
                document.body.removeChild(document.getElementById("gbox"));
                gameFrame.onload = function() {
                    if (!isListenerInited) {
                        initMessageListener();
                        isListenerInited = true
                    }
                    document.getElementById("loader").style.display = "none"
                };
                cb && cb()
            }
            if (data.tredirect) {
                if (window.passType == "YYBYOUGSER") {
                    loadScript("http://qcdn.11h5.com/static/js/gc.min.js", function() {
                        loadScript("http://qcdn.11h5.com/static/js/zepto.min.js", function() {
                            GC.yybLogin()
                        })
                    })
                } else {
                    top.location.href = data.tredirect
                }
                return
            }
            if (data.data) {
                login_params = data.data
            }
        })
    };

    function getCookie(name) {
        var cookies = document.cookie;
        var cookieIndex = cookies.indexOf(name);
        if (cookieIndex != -1) {
            cookieIndex += name.length + 1;
            var cookie_end = cookies.indexOf(";", cookieIndex);
            if (cookie_end == -1) {
                cookie_end = cookies.length
            }
            var value = unescape(cookies.substring(cookieIndex, cookie_end))
        }
        return value
    }
    var init = function(data) {
        var passData = data[Object.keys(data)[0]];
        passType = JSON.parse(passData).passType;
        passId = Object.keys(data)[0];
        appid = data.appid;
        server_id = data.server_id;
        gameId = JSON.parse(passData).gameId || JSON.parse(passData).browserId || JSON.parse(passData).gKey;
        shareInfo = data.shareInfo;
        if (data.test) {
            passHost = "http://zjj.h5game.cn/pass3"
        } else {
            passHost = "http://passa.gz.1251010508.clb.myqcloud.com/pass_a"
        }
        switch (passType) {
            case "BROSER":
                loadScript("http://dev.jsapi.qq.com/get?api=x5gameplayer.*", function() {
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                setBackEvent();
                break;
            case "QZONESER":
                loadScript("http://qzonestyle.gtimg.cn/qzone/mobilepage/gamesBar/common/pop_pay_tips.js", function() {
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                setBackEvent();
                if (mqq && mqq.data) {
                    mqq.data.setShareInfo({
                        title: shareInfo.title,
                        desc: shareInfo.desc,
                        image_url: shareInfo.imgUrl,
                        callback: function() {
                            console.log("分享回调")
                        }
                    })
                }
                break;
            case "ZSBFSER":
                loadScript("http://pf.h5game.cn/platform/phone/js/payment.js?v=1", function() {
                    BFWY.ready = BFWY.ready || function(fn) {
                        fn()
                    };
                    BFWY.ready(function() {
                        BFWY.shade({
                            title: shareInfo.title,
                            imgUrl: shareInfo.imgUrl
                        }, function() {
                            postMessage(MESSAGES.SHARE_CALLBACK, true)
                        });
                        postMessage(MESSAGES.INIT_CALLBACK)
                    })
                });
                setBackEvent();
                break;
            case "FKSER":
                FKInit(shareInfo);
                break;
            case "YOUGSER":
                loadScript("http://qcdn.11h5.com/static/js/gc.min.js", function() {
                    loadScript("http://qcdn.11h5.com/static/js/zepto.min.js", function() {
                        console.log("设置分享回调");
                        try {
                            GC.enableUnionShare(function(d) {
                                postMessage(MESSAGES.SHARE_CALLBACK, true)
                            })
                        } catch (e) {
                            alert(e)
                        }
                        postMessage(MESSAGES.INIT_CALLBACK)
                    })
                });
                break;
            case "newGameSER":
                loadScript("http://hi.newgame.com/m/static/sdk/play-game.js", function() {
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "XLSER":
                loadScript("http://bt.h5game.cn/passa/js/platforms/sina_bridge.js", function() {
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "YYSER":
                postMessage(MESSAGES.INIT_CALLBACK);
                break;
            case "BAISISER":
                loadScript("http://h5.mobo168.com/open/sdk/ldgame.js", function() {
                    pfsdk = new ldgame({
                        app_key: pf_params.app_key
                    });
                    pfsdk.setwxsharecallback(function() {
                        postMessage(MESSAGES.SHARE_CALLBACK, true)
                    });
                    setTimeout(function() {
                        console.log("bssdk加载完成");
                        postMessage(MESSAGES.INIT_CALLBACK)
                    }, 500)
                });
                break;
            case "G9SER":
                loadScript("http://game.9g.com/js/lib.v2.js", function() {
                    pfsdk = new Game9G({
                        gameid: gameId,
                        token: pf_params.token
                    });
                    pfsdk.ready(function() {
                        pfsdk.setShareData({
                            title: shareInfo.title,
                            content: shareInfo.desc
                        });
                        pfsdk.onShareOK(function() {
                            console.log("9G share succ!");
                            postMessage(MESSAGES.SHARE_CALLBACK, true)
                        });
                        postMessage(MESSAGES.INIT_CALLBACK)
                    })
                });
                break;
            case "QHSER":
                window.onShareSucc = function() {
                    postMessage(MESSAGES.SHARE_CALLBACK, true)
                };
                postMessage(MESSAGES.INIT_CALLBACK);
                break;
            case "w68SER":
                loadScript("http://static.play68.com/js/play68_sdk.js", function() {
                    pfsdk = Play68;
                    pfsdk.setShareInfo(shareInfo.title, shareInfo.desc);
                    pfsdk.set_share_icon(shareInfo.imgUrl);
                    window.on_wx_share_succ = function() {
                        postMessage(MESSAGES.SHARE_CALLBACK, true)
                    };
                    pfsdk.onpaysucc(function() {
                        parent.location.href = document.referrer
                    });
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "y1758SER":
                loadScript("http://wx.1758.com/static/common/js/hlmy1758.js", function() {
                    pfsdk = hlmy;
                    pfsdk.setShareInfo({
                        state: appid + "_" + shareInfo.status,
                        tipInfo: false,
                        reward: []
                    });
                    console.log(appid + "_" + shareInfo.status);
                    window.onShareTimeline = function() {
                        postMessage(MESSAGES.SHARE_CALLBACK, true)
                    };
                    window.onShareFriend = function() {
                        postMessage(MESSAGES.SHARE_CALLBACK, true)
                    };
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "IQYSER":
                var msg = {
                    position: "game_load",
                    data: "success"
                };
                window.parent.postMessage(msg, "http://togame.pps.tv");
                window.parent.postMessage(msg, "http://togame.iqiyi.com");
                window.parent.postMessage(msg, "http://playgame.pps.tv");
                window.parent.postMessage(msg, "http://playgame.iqiyi.com");
                window.parent.postMessage(msg, "http://playgame2.iqiyi.com");
                postMessage(MESSAGES.INIT_CALLBACK);
                break;
            case "GMSER":
                loadScript("http://cdn.ibeargame.com/res-js/bear.js", function() {
                    console.log("bear loaded");
                    window.addEventListener("message", function(e) {
                        if (e.data.action == "share") {
                            postMessage(MESSAGES.SHARE_CALLBACK, true)
                        }
                    });
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "TIANWSER":
                loadScript("http://open.juhesdk.twan.cn/js/juhe.js", function() {
                    pfsdk = JUHE;
                    pfsdk.authed(function(data) {
                        var data = typeof data === "object" ? data : eval("(" + data + ")");
                        if (data && data.uid && data.token) {
                            JUHE.authin(gameId, function(data) {
                                var data = typeof data === "object" ? data : eval("(" + data + ")");
                                if (data && data.result && data.result == "success") {
                                    JUHE.uinfo(function(data) {
                                        console.log("uinfo", data)
                                    }, this);
                                    postMessage(MESSAGES.INIT_CALLBACK)
                                } else {
                                    alert("authin fail认证失败")
                                }
                            }, this)
                        } else {
                            alert("authed fail获取用户信息检测失败，请重新登录")
                        }
                    }, this)
                });
                break;
            case "H360SER":
                H5SDK.shareGamePort({
                    title: shareInfo.title,
                    content: shareInfo.desc,
                    icon: shareInfo.imgUrl,
                    url: "",
                    success: function() {
                        postMessage(MESSAGES.SHARE_CALLBACK, true)
                    }
                });
                postMessage(MESSAGES.INIT_CALLBACK);
                break;
            case "LUOBSER":
                loadScript("http://m.59yx.com/Public/jssdk/js/jssdk.js", function() {
                    pfsdk = new ylGame({
                        debug: false
                    });
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "YYBYOUGSER":
                loadScript("http://qcdn.11h5.com/static/js/gc.min.js", function() {
                    loadScript("http://qcdn.11h5.com/static/js/zepto.min.js", function() {
                        postMessage(MESSAGES.INIT_CALLBACK)
                    })
                });
                break;
            case "QUQSER":
                loadScript("http://statics.77163.com/js/pay/77163paygame.js", function() {
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "MEITSER":
                quwanwansdk.change_share_info({
                    title: shareInfo.title,
                    summary: shareInfo.desc,
                    img_url: shareInfo.imgUrl,
                    callFunc: function(status) {
                        if (status == "success") {
                            postMessage(MESSAGES.SHARE_CALLBACK, true)
                        }
                    },
                    show_share: false
                });
                postMessage(MESSAGES.INIT_CALLBACK);
                break;
            case "AIAYSER":
                loadScript("http://passport.aiaiu.com/game/h5sdk", function() {
                    aiaiusdk.init();
                    postMessage(MESSAGES.INIT_CALLBACK)
                });
                break;
            case "LAYASER":
                pfsdk = LayaBoxMarket.getInstance();
                postMessage(MESSAGES.INIT_CALLBACK);
                break
        }
    };

    function setBackEvent() {
        "pushState" in window.history && (window.history.pushState({
            title: document.title,
            url: location.href
        }, document.title, location.href), setTimeout(function() {
            window.addEventListener("popstate", function(a) {
                showConfirm("确认要退出游戏么？", function() {
                    closePayWindow();
                    window.history.go(-1)
                }, function() {
                    "pushState" in window.history && (window.history.pushState({
                        title: document.title,
                        url: location.href
                    }, document.title, location.href))
                })
            })
        }, 1000))
    }
    var FKInit = function(shareInfo) {
        loadScript("http://h5.hortorgames.com/sdk/sdk_agent.min.js", function() {
            try {
                var sdk = window.HORTOR_AGENT;
                sdk.init();
                postMessage(MESSAGES.INIT_CALLBACK);
                sdk.config({
                    gameId: gameId,
                    share: {
                        timeline: {
                            title: shareInfo && shareInfo.title || "",
                            imgUrl: shareInfo && shareInfo.imgUrl || "",
                            success: function() {
                                postMessage(MESSAGES.SHARE_CALLBACK, true)
                            },
                            cancel: function() {
                                postMessage(MESSAGES.SHARE_CALLBACK, false)
                            }
                        },
                        friend: {
                            title: shareInfo && shareInfo.title || "",
                            imgUrl: shareInfo && shareInfo.imgUrl || "",
                            desc: shareInfo && shareInfo.desc || "",
                            success: function() {
                                postMessage(MESSAGES.SHARE_CALLBACK, true)
                            },
                            cancel: function() {
                                postMessage(MESSAGES.SHARE_CALLBACK, false)
                            }
                        },
                        shareCustomParam: {
                            cp_fuid: shareInfo && shareInfo.openId || "xxxxxxx"
                        }
                    },
                    pay: {
                        success: function() {
                            toastMsg("充值成功");
                            document.getElementById("loading").style.display = "none";
                            postMessage(MESSAGES.RECHARGE_CALLBACK, 1)
                        },
                        cancel: function() {
                            toastMsg("充值取消");
                            document.getElementById("loading").style.display = "none";
                            postMessage(MESSAGES.RECHARGE_CALLBACK, 2)
                        }
                    }
                })
            } catch (e) {
                alert(e)
            }
        })
    };

    function setShareInfo(infos) {}

    function setSpecialShare(data) {
        if (data.channel == 2000004) {}
    }
    var createPay = function(param, cb) {
        var param = param || {};
        var url = passHost + "/jdk/";
        switch (passType) {
            case "newgame":
                url += "newgameCreatepay" + param.search;
                getDataXHR(url, function(res) {
                    var data = res;
                    window.location.href = data.payUrl
                });
                break;
            case "fengkuang":
                url += "createPay" + param.search;
                getDataXHR(url, function(res) {
                    var data = res;
                    var sdk = window.HORTOR_AGENT;
                    sdk.pay(data)
                });
                break;
            case "1758":
                url += "createPrice" + param.search;
                getDataXHR(url, function(res) {
                    var data = res;
                    console.log(data);
                    parent.window.location.href = data.payUrl
                });
                break;
            case "qqminigame":
                url += "qqGameCreatePay" + param.search;
                try {
                    getDataXHR(url, function(res) {
                        cb && cb()
                    })
                } catch (e) {
                    console.log(e)
                }
                break;
            case "9g":
                url += "G9createPay" + param.search;
                getDataXHR(url, function(res) {
                    cb && cb(res)
                });
                break;
            default:
                url += "psa/" + passId + "/createPay" + param.search;
                getDataXHR(url, function(res) {
                    var data = res;
                    cb && cb(data)
                });
                break
        }
    };
    var openTopicCircle = function() {
        switch (passType) {
            case "BROSER":
                try {
                    var xversion = browser.x5gameplayer.version();
                    if (xversion >= 62) {
                        browser.x5gameplayer.openTopicCircle({
                            appId: gameId
                        }, function(result, msg) {})
                    }
                } catch (e) {
                    alert(e)
                }
                break;
            case "1758SER":
                top.window.location.href = "http://wx.1758.com/hlmy/cdkeys.htm?appKey=" + pf_params.appKey;
                break
        }
    };
    var qqBorwserLogout = function(openId) {
        debugtolog("登出");
        debugtolog(JSON.stringify(pf_params));
        try {
            browser.x5gameplayer.logout({
                appid: window.appid,
                loginType: "all",
                qbopenid: pf_params.qbopenid
            }, function(d) {
                if (d.result == 0) {
                    deleteCookie("openid");
                    deleteCookie("openkey");
                    deleteCookie("refreshToken");
                    deleteCookie("loginType");
                    location.href = location.href
                } else {
                    toastMsg(d.msg)
                }
            })
        } catch (e) {
            debugtolog(e)
        }
    };
    var sendToDesktop = function() {
        switch (passType) {
            case "BROSER":
                try {
                    browser.x5gameplayer.sendToDesktop({
                        ext: ""
                    }, function(result, msg) {
                        if (result == 0) {
                            postMessage(MESSAGES.SENDTODESKTOP_CALLBACK, true)
                        } else {
                            postMessage(MESSAGES.SENDTODESKTOP_CALLBACK, false)
                        }
                    })
                } catch (e) {
                    alert(e)
                }
                break;
            case "XLSER":
                try {
                    addShortcut()
                } catch (e) {
                    alert(e)
                }
                break;
            case "IQYSER":
                break;
            case "H360SER":
                H5SDK.createDesktopLinkPort({
                    url: "http://h5game.u.360.cn/?gkey=jzsch5",
                    logo: "http://cdn.7yao.top/m2/loadingRes/chuanqi.jpg",
                    name: "决战沙城H5"
                });
                break
        }
    };
    var checkFocus = function(checkdata) {
        debugtolog("查询登陆状态     " + JSON.stringify(checkdata));
        var openId = checkdata.openId;
        var openKey = checkdata.openKey;
        var appId = checkdata.appId;
        switch (passType) {
            case "G9SER":
                pfsdk.checkSubscribe(function(result) {
                    var ret = result == 1 ? 1 : 0;
                    postMessage(MESSAGES.FOCUS_RETURNSTATE, ret)
                });
                break;
            case "YOUGSER":
                var url = passHost + "/jdk/psa/" + passId + "/focus?appId=" + appId + "&openId=" + openId + "&openKey=" + openKey;
                getDataXHR(url, function(res) {
                    if (res.code == 0) {
                        postMessage(MESSAGES.FOCUS_RETURNSTATE, 1)
                    } else {
                        postMessage(MESSAGES.FOCUS_RETURNSTATE, 0)
                    }
                });
                break;
            case "w68SER":
                if (Play68.getCpWxInfo()) {
                    postMessage(MESSAGES.FOCUS_RETURNSTATE, 0)
                } else {
                    postMessage(MESSAGES.FOCUS_RETURNSTATE, -1)
                }
                break;
            case "ZSBFSER":
                BFWY.isAttention(function(game) {
                    if (BFWY.root.game.haveFollowButton) {
                        if (game.isAttention) {
                            postMessage(MESSAGES.FOCUS_RETURNSTATE, 1)
                        } else {
                            postMessage(MESSAGES.FOCUS_RETURNSTATE, 0)
                        }
                    } else {
                        postMessage(MESSAGES.FOCUS_RETURNSTATE, -1)
                    }
                });
                break;
            case "y1758SER":
                var url = passHost + "/jdk/psa/" + passId + "/focus?appId=" + appId + "&openId=" + openId + "&openKey=" + openKey;
                getDataXHR(url, function(res) {
                    if (res.code == 0) {
                        postMessage(MESSAGES.FOCUS_RETURNSTATE, 1)
                    } else {
                        postMessage(MESSAGES.FOCUS_RETURNSTATE, 0)
                    }
                });
                break;
            case "TIANWSER":
                pfsdk.useattention(function(data) {
                    var d = typeof data === "object" ? data : eval("(" + data + ")");
                    if (d && d.err) {} else {
                        if (d && d.result) {
                            d = d.result;
                            if (d == "success") {
                                JUHE.isattention(function(data) {
                                    var d = typeof data === "object" ? data : eval("(" + data + ")");
                                    if (d && d.err) {} else {
                                        if (d && d.result) {
                                            d = d.result;
                                            if (d == "success") {
                                                postMessage(MESSAGES.FOCUS_RETURNSTATE, 1)
                                            } else {
                                                if (d == "fail") {
                                                    postMessage(MESSAGES.FOCUS_RETURNSTATE, 0)
                                                }
                                            }
                                        }
                                    }
                                }, this)
                            } else {
                                if (d == "fail") {
                                    postMessage(MESSAGES.FOCUS_RETURNSTATE, -1)
                                }
                            }
                        }
                    }
                }, this);
                break;
            default:
                postMessage(MESSAGES.FOCUS_RETURNSTATE, -1);
                break
        }
    };
    var reportData = function(data) {
        console.log(data);
        switch (passType) {
            case "newGameSER":
                NewGame.reportData({
                    action: data.action,
                    app_id: gameId,
                    open_id: data.app_openid,
                    server: data.server
                });
                break;
            case "YOUGSER":
                reyunReport(data);
                break;
            case "FKSER":
                reyunReport(data);
                break;
            case "y1758SER":
                reyunReport(data);
                break;
            case "w68SER":
                reyunReport(data);
                break;
            case "QHSER":
                reyunReport(data);
                break;
            case "YYBYOUGSER":
                reyunReport(data);
                break;
            case "G9SER":
                if (data.action == "create_role") {
                    var role = {
                        server_id: data.server,
                        server_name: data.server,
                        role_id: data.openId,
                        nickname: data.nickName
                    };
                    game9g.createRole(role)
                }
                break;
            case "IQYSER":
                if (data.action == "create_role") {
                    var d = {
                        openId: data.openId,
                        openKey: data.openKey || "",
                        appId: appid,
                        passId: passId,
                        serverId: server_id,
                        username: data.nickName,
                        level: data.level || 1,
                        type: 0
                    };
                    getDataXHR("http://passa.gz.1251010508.clb.myqcloud.com/pass_a/stat/statChoose.jsp" + object2search(d));
                    getDataXHR(passHost + "/jdk/psa/" + passId + "/stat" + object2search(d))
                }
                if (data.action == "login") {
                    var d = {
                        openId: data.openId,
                        openKey: data.openKey || "",
                        appId: appid,
                        passId: passId,
                        serverId: server_id,
                        username: data.nickName,
                        level: data.level || 1,
                        type: 1
                    };
                    getDataXHR(passHost + "/jdk/psa/" + passId + "/stat" + object2search(d))
                }
                break;
            case "XLSER":
                if (data.action == "create_role") {
                    var url = passHost + "/jdk/psa/" + passId + "/chooseRole";
                    var d = {
                        openId: data.openId,
                        openKey: data.openKey,
                        appId: appid
                    };
                    getDataXHR(url + object2search(d))
                }
                break;
            case "TIANWSER":
                if (data.action == "login") {
                    JUHE.ulogin(data.server, function() {
                        console.log("天玩上报")
                    }, this)
                }
                break;
            case "YUEWSER":
                if (data.action == "login") {
                    var d = {
                        openId: data.openId,
                        openKey: data.openKey || "",
                        appId: appid
                    };
                    getDataXHR(passHost + "/jdk/psa/" + passId + "/stat" + object2search(d))
                }
                break;
            case "PPTVSER":
                if (data.action == "create_role") {
                    var d = {
                        openId: data.openId,
                        openKey: data.openKey || "",
                        appId: appid,
                        passId: passId,
                        serverId: server_id,
                        username: data.nickName,
                        level: data.level || 1,
                        type: 0
                    };
                    getDataXHR(passHost + "/jdk/psa/" + passId + "/stat" + object2search(d))
                }
                if (data.action == "login") {
                    var d = {
                        openId: data.openId,
                        openKey: data.openKey || "",
                        appId: appid,
                        passId: passId,
                        serverId: server_id,
                        username: data.nickName,
                        level: data.level || 1,
                        type: 1
                    };
                    getDataXHR(passHost + "/jdk/psa/" + passId + "/stat" + object2search(d))
                }
                break
        }
    };
    var onLoginError = function(loginUrl) {
        switch (passType) {
            case "YYBYOUGSER":
                GC.yybLogin();
                break;
            default:
                if (loginUrl) {
                    top.location.href = loginUrl
                } else {
                    top.location.replace(document.referrer)
                }
                break
        }
    };
    var reyunReport = function(data) {
        var action;
        if (data.action == "login") {
            action = "/receive/login";
            getDataXHR(reyunUrl + action, function() {}, {
                type: "post",
                data: JSON.stringify({
                    appid: reyunAppId,
                    who: data.openId,
                    deviceid: data.openId,
                    serverid: data.server,
                    channelid: appid,
                    idfa: "",
                    idfv: "",
                    level: -1
                })
            }, "application/x-www-form-urlencoded;charset=UTF-8");
            reyunHeartBeat(data)
        }
        if (data.action == "create_role") {
            action = "/receive/register";
            getDataXHR(reyunUrl + action, function() {}, {
                type: "post",
                data: JSON.stringify({
                    appid: reyunAppId,
                    who: data.openId,
                    deviceid: data.openId,
                    serverid: data.server,
                    channelid: appid,
                    idfa: "",
                    idfv: "",
                    accounttype: "",
                    gender: "",
                    age: ""
                })
            }, "application/x-www-form-urlencoded;charset=UTF-8")
        }
    };
    var reyunHeartBeat = function(data) {
        setInterval(function() {
            console.log("reyunhb");
            var action = "/receive/online";
            getDataXHR(reyunUrl + action, function() {}, {
                type: "post",
                data: JSON.stringify({
                    appid: reyunAppId,
                    who: data.openId,
                    deviceid: data.openId,
                    serverid: data.server,
                    channelid: appid,
                    level: -1
                })
            }, "application/x-www-form-urlencoded;charset=UTF-8")
        }, 300000)
    };
    var showQrCode = function() {
        switch (passType) {
            case "YOUGSER":
                GC.focus();
                break;
            case "FKSER":
                var sdk = window.HORTOR_AGENT;
                sdk.showQRCode();
                break;
            case "G9SER":
                pfsdk.gotoSubscribe();
                break;
            case "w68SER":
                var wxdata = pfsdk.getCpWxInfo();
                if (wxdata && wxdata.play68) {
                    top.location.href = wxdata.play68
                }
                break;
            case "ZSBFSER":
                BFWY.showAttention();
                break;
            case "y1758SER":
                pfsdk.follow();
                break
        }
    };
    var isOpenShare = function() {
        switch (window.passType) {
            case "YOUGSER":
            case "FKSER":
            case "G9SER":
            case "y1758SER":
            case "XLSER":
            case "QHSER":
                postMessage(MESSAGES.RETURNSHARE, true);
                break;
            case "ZSBFSER":
                if (BFWY.root.game.haveInviteButton == 1) {
                    postMessage(MESSAGES.RETURNSHARE, true)
                } else {
                    postMessage(MESSAGES.RETURNSHARE, false)
                }
                break;
            case "BAISISER":
                if (pfsdk.isshowshare()) {
                    postMessage(MESSAGES.RETURNSHARE, true)
                } else {
                    postMessage(MESSAGES.RETURNSHARE, false)
                }
                break;
            default:
                postMessage(MESSAGES.RETURNSHARE, false);
                break
        }
    };
    var pay = function(amount, orderData) {
        var p = getParameters();
        var orderNo = orderData.orderNo;
        var qbopenid = orderData.openId || p.openId || p.user;
        var refreshToken = decodeURIComponent(p.refreshToken);
        var qbopenkey = orderData.openKey || p.openKey;
        var gameAppId = orderData.appId || p.appId || p.appid;
        var ext = orderData.ext;
        if (passType == "BROSER") {
            var options = {
                appId: gameAppId,
                openId: qbopenid,
                openKey: qbopenkey,
                money: amount,
                appOrderId: orderNo,
                ext: ext
            };
            var search = object2search(options);
            createPay({
                search: search
            }, function(d) {
                try {
                    browser.x5gameplayer.pay(d, function(rsp) {
                        document.getElementById("loading").style.display = "none";
                        if (rsp.result == 0) {
                            toastMsg("充值成功");
                            postMessage(parent.window, MESSAGES.RECHARGE_CALLBACK, 1)
                        } else {
                            if (rsp.result == -3 || rsp.result == -5 || rsp.result == 19) {
                                toastMsg("您的登录状态已经过期，请重新登录游戏");
                                deleteCookie("openid");
                                deleteCookie("openkey");
                                deleteCookie("refreshToken");
                                deleteCookie("loginType");
                                location.href = location.href
                            } else {
                                if (rsp.result == -4) {
                                    toastMsg("刷新账号")
                                } else {
                                    if (rsp.result == -1) {
                                        postMessage(MESSAGES.RECHARGE_CALLBACK, 0);
                                        toastMsg("充值已取消")
                                    } else {
                                        toastMsg(rsp.msg)
                                    }
                                }
                            }
                        }
                    })
                } catch (e) {
                    toastMsg(e)
                }
            })
        } else {
            if (passType == "QZONESER") {
                if (UA.indexOf("Qzone") != -1 && !isAndroid) {
                    alert("IOS用户充值推荐使用QQ浏览器，登录空间进行充值，可以继续享受更多充值额度以及8折优惠！")
                }
                var zoneId = isAndroid ? 1 : 2;
                var openId = orderData.openId || p.openId || p.user;
                var openKey = orderData.openKey || p.openKey;
                var money = amount;
                var url = passHost + "/jdk/psa/" + passId + "/view";
                var param = {
                    appId: gameAppId,
                    openId: openId,
                    openKey: openKey,
                    zoneId: zoneId
                };
                window.__paySuccess = function() {
                    pay(amount, orderData)
                };
                window.__payClose = function() {
                    toastMsg("支付已取消");
                    document.getElementById("loading").style.display = "none"
                };
                window.__payError = function() {
                    toastMsg("支付失败");
                    document.getElementById("loading").style.display = "none"
                };
                getDataXHR(url + object2search(param), function(res) {
                    var data = res;
                    if (data.ret == 1002) {
                        toastMsg("登陆状态过期，请尝试在玩吧入口重新进入游戏");
                        return
                    }
                    var score = data.score;
                    var appId = data.appId;
                    var isVip = data.isVip;
                    var need = isVip ? amount * 0.8 : amount;
                    document.getElementById("loading").style.display = "none";
                    if (need / 10 <= score) {
                        showConfirm("确认花费" + need / 10 + "星币进行兑换?", function() {
                            var p = {};
                            p.openId = openId;
                            p.openKey = openKey;
                            p.appId = gameAppId;
                            p.money = amount;
                            p.appOrderId = orderNo;
                            p.ext = ext;
                            p.zoneId = zoneId;
                            p.data = "";
                            var search = object2search(p);
                            document.getElementById("loading").style.display = "block";
                            createPay({
                                search: search
                            }, function(d) {
                                if (d.code == "success") {
                                    toastMsg("充值成功");
                                    document.getElementById("loading").style.display = "none"
                                }
                                document.getElementById("loading").style.display = "none"
                            })
                        })
                    } else {
                        window.popPayTips({
                            is_vip: isVip,
                            openkey: openKey,
                            openid: openId,
                            appid: appId,
                            zoneid: zoneId,
                            score: score,
                            defaultScore: need / 10
                        })
                    }
                })
            } else {
                if (passType == "ZSBFSER") {
                    document.getElementById("loading").style.display = "block";
                    var openId = orderData.openId;
                    var openKey = orderData.openKey;
                    var param = {};
                    try {
                        param.openId = openId;
                        param.openKey = openKey;
                        param.appOrderId = orderNo;
                        param.appId = appid;
                        param.money = amount;
                        param.ext = ext;
                        param.data = "";
                        var search = object2search(param);
                        createPay({
                            search: search
                        }, function(d) {
                            BFPayment(d, function(data) {
                                if (data.code == "001") {
                                    toastMsg("充值成功!")
                                } else {
                                    if (data.code == "006") {
                                        toastMsg("充值完成")
                                    } else {
                                        toastMsg("充值失败，请重试")
                                    }
                                }
                                document.getElementById("loading").style.display = "none"
                            })
                        })
                    } catch (e) {
                        alert(e)
                    }
                } else {
                    if (passType == "FKSER") {
                        document.getElementById("loading").style.display = "block";
                        var openId = orderData.openId;
                        var openKey = orderData.openKey;
                        var param = {};
                        param.openId = openId;
                        param.openKey = openKey;
                        param.appOrderId = orderNo;
                        param.appId = appid;
                        param.money = amount;
                        param.goodsId = itemId;
                        param.goodsName = itemName;
                        param.ext = ext;
                        param.data = "";
                        var search = object2search(param);
                        createPay({
                            search: search
                        }, function(res) {
                            var sdk = window.HORTOR_AGENT;
                            console.log("h5game", sdk);
                            sdk.pay(res)
                        })
                    } else {
                        if (passType == "YOUGSER") {
                            document.getElementById("loading").style.display = "block";
                            var openId = orderData.openId;
                            var openKey = orderData.openKey;
                            var param = {};
                            param.openId = openId;
                            param.openKey = openKey;
                            param.appId = appid;
                            param.money = amount;
                            param.appOrderId = orderNo;
                            param.ext = ext;
                            param.data = "";
                            var search = object2search(param);
                            createPay({
                                search: search
                            }, function(res) {
                                var url = res.payUrl;
                                var param = {};
                                var p = url.split("?")[1].split("&");
                                for (var i = 0; i < p.length; i++) {
                                    param[p[i].split("=")[0]] = p[i].split("=")[1]
                                }
                                if (!param.txid) {
                                    toastMsg("订单错误，请重试");
                                    document.getElementById("loading").style.display = "none";
                                    return
                                }
                                document.getElementById("loading").style.display = "none";
                                GC.jumpPay(param)
                            })
                        } else {
                            if (passType == "newGameSER") {
                                document.getElementById("loading").style.display = "block";
                                var openId = orderData.openId;
                                var openKey = orderData.openKey;
                                var param = {};
                                param.openId = openId;
                                param.openKey = openKey;
                                param.appId = appid;
                                param.money = amount;
                                param.appOrderId = orderNo;
                                param.ext = ext;
                                param.data = "";
                                param.subject = orderData.subject || "元宝";
                                param.body = (orderData.subject || "元宝") + "*" + amount;
                                param.appUserName = orderData.appUserName || "玩家";
                                var search = object2search(param);
                                createPay({
                                    search: search
                                }, function(data) {
                                    document.getElementById("loading").style.display = "none";
                                    NewGame.openIframePopup({
                                        src: data.payUrl
                                    })
                                })
                            } else {
                                if (passType == "XLSER") {
                                    var xlpayurl = "http://m.game.weibo.cn/payment/order/order_cashier";
                                    document.getElementById("loading").style.display = "block";
                                    var openId = orderData.openId;
                                    var openKey = orderData.openKey;
                                    var param = {};
                                    param.openId = openId;
                                    param.openKey = openKey;
                                    param.appId = appid;
                                    param.money = amount;
                                    param.appOrderId = orderNo;
                                    param.ext = ext;
                                    param.data = "";
                                    var search = object2search(param);
                                    createPay({
                                        search: search
                                    }, function(data) {
                                        data.subject = orderData.subject || "兑换";
                                        data.desc = (orderData.subject || "兑换x") + amount;
                                        document.getElementById("loading").style.display = "none";
                                        var ps = object2search(data);
                                        window.top.location.href = xlpayurl + ps
                                    })
                                } else {
                                    if (passType == "YYSER") {
                                        document.getElementById("loading").style.display = "block";
                                        var openId = orderData.openId;
                                        var openKey = orderData.openKey;
                                        var param = {};
                                        param.openId = openId;
                                        param.openKey = openKey;
                                        param.appId = appid;
                                        param.money = amount;
                                        param.appOrderId = orderNo;
                                        param.ext = ext;
                                        param.data = "";
                                        param.goodsName = orderData.subject || "元宝";
                                        param.appUserName = orderData.appUserName || "玩家";
                                        var search = object2search(param);
                                        createPay({
                                            search: search
                                        }, function(data) {
                                            document.getElementById("loading").style.display = "none";
                                            top.window.location.href = data.payUrl
                                        })
                                    } else {
                                        if (passType == "G7724SER") {
                                            var xlpayurl = "http://i.7724.com/recharge/sdkindex";
                                            document.getElementById("loading").style.display = "block";
                                            var openId = orderData.openId;
                                            var openKey = orderData.openKey;
                                            var param = {};
                                            param.openId = openId;
                                            param.openKey = openKey;
                                            param.appId = appid;
                                            param.money = amount;
                                            param.subject = orderData.subject || "元宝";
                                            param.appOrderId = orderNo;
                                            param.ext = ext;
                                            param.data = "";
                                            var search = object2search(param);
                                            createPay({
                                                search: search
                                            }, function(data) {
                                                document.getElementById("loading").style.display = "none";
                                                var ps = object2search(data);
                                                window.top.location.href = xlpayurl + ps
                                            })
                                        } else {
                                            if (passType == "BAISISER") {
                                                document.getElementById("loading").style.display = "block";
                                                var openId = orderData.openId;
                                                var openKey = orderData.openKey;
                                                var param = {};
                                                param.openId = openId;
                                                param.openKey = openKey;
                                                param.appId = appid;
                                                param.money = amount;
                                                param.subject = orderData.subject || "元宝";
                                                param.appOrderId = orderNo;
                                                param.ext = ext;
                                                param.data = "";
                                                var search = object2search(param);
                                                createPay({
                                                    search: search
                                                }, function(data) {
                                                    document.getElementById("loading").style.display = "none";
                                                    pfsdk.pay(data, function() {
                                                        toastMsg("充值完成")
                                                    })
                                                })
                                            } else {
                                                if (passType == "G9SER") {
                                                    document.getElementById("loading").style.display = "block";
                                                    var openId = orderData.openId;
                                                    var openKey = orderData.openKey;
                                                    var param = {};
                                                    param.openId = openId;
                                                    param.openKey = openKey;
                                                    param.appId = appid;
                                                    param.money = amount;
                                                    param.subject = orderData.subject || "元宝";
                                                    param.appOrderId = orderNo;
                                                    param.ext = ext;
                                                    param.data = "";
                                                    var search = object2search(param);
                                                    createPay({
                                                        search: search
                                                    }, function(data) {
                                                        document.getElementById("loading").style.display = "none";
                                                        var p = {};
                                                        p.onPayCallback = function() {
                                                            toastMsg("充值完成");
                                                            postMessage(MESSAGES.RECHARGE_CALLBACK, 1)
                                                        };
                                                        p.onPayCancel = function() {
                                                            toastMsg("充值已取消");
                                                            postMessage(MESSAGES.RECHARGE_CALLBACK, 0)
                                                        };
                                                        p.sign = data.sign;
                                                        p.spid = data.spId;
                                                        p.money = amount;
                                                        p.product = orderData.subject || "元宝";
                                                        p.attach = "";
                                                        p.orderid = data.orderId;
                                                        pfsdk.pay(p)
                                                    })
                                                } else {
                                                    if (passType == "QHSER") {
                                                        document.getElementById("loading").style.display = "block";
                                                        var openId = orderData.openId;
                                                        var openKey = orderData.openKey;
                                                        var param = {};
                                                        param.openId = openId;
                                                        param.openKey = openKey;
                                                        param.appId = appid;
                                                        param.money = amount;
                                                        param.goodsName = orderData.subject || "元宝";
                                                        param.appOrderId = orderNo;
                                                        param.ext = ext;
                                                        param.data = "";
                                                        var search = object2search(param);
                                                        createPay({
                                                            search: search
                                                        }, function(data) {
                                                            top.location.href = data.payUrl
                                                        })
                                                    } else {
                                                        if (passType == "w68SER") {
                                                            document.getElementById("loading").style.display = "block";
                                                            var openId = orderData.openId;
                                                            var openKey = orderData.openKey;
                                                            var param = {};
                                                            param.openId = openId;
                                                            param.openKey = openKey;
                                                            param.appId = appid;
                                                            param.money = amount;
                                                            param.itemName = orderData.subject || "元宝";
                                                            param.appOrderId = orderNo;
                                                            param.ext = ext;
                                                            param.data = "";
                                                            var search = object2search(param);
                                                            createPay({
                                                                search: search
                                                            }, function(data) {
                                                                document.getElementById("loading").style.display = "none";
                                                                pfsdk.pay(data.itemid, data.itemname, data.price, data.count, data.spec, data.skey)
                                                            })
                                                        } else {
                                                            if (passType == "y1758SER") {
                                                                document.getElementById("loading").style.display = "block";
                                                                var openId = orderData.openId;
                                                                var openKey = orderData.openKey;
                                                                var param = {};
                                                                param.openId = openId;
                                                                param.openKey = openKey;
                                                                param.appId = appid;
                                                                param.money = amount;
                                                                param.appOrderId = orderNo;
                                                                param.ext = ext;
                                                                param.data = "";
                                                                var search = object2search(param);
                                                                createPay({
                                                                    search: search
                                                                }, function(data) {
                                                                    document.getElementById("loading").style.display = "none";
                                                                    console.log(data);
                                                                    pfsdk.pay({
                                                                        itemCode: data.itemCode,
                                                                        txId: data.txid,
                                                                        state: ""
                                                                    })
                                                                })
                                                            } else {
                                                                if (passType == "IQYSER") {
                                                                    document.getElementById("loading").style.display = "block";
                                                                    var openId = orderData.openId;
                                                                    var openKey = orderData.openKey;
                                                                    var param = {};
                                                                    param.openId = openId;
                                                                    param.openKey = openKey;
                                                                    param.appId = appid;
                                                                    param.money = amount;
                                                                    param.appOrderId = orderNo;
                                                                    param.ext = ext;
                                                                    param.data = "";
                                                                    var search = object2search(param);
                                                                    createPay({
                                                                        search: search
                                                                    }, function(data) {
                                                                        var p = "game_id=" + data.game_id + "&user_id=" + data.user_id + "&server_id=" + 1 + "&money=" + data.money + "&extra_param=" + data.extra_param;
                                                                        console.log(p);
                                                                        document.getElementById("loading").style.display = "none";
                                                                        window.parent.postMessage(p, "http://togame.pps.tv");
                                                                        window.parent.postMessage(p, "http://togame.iqiyi.com");
                                                                        window.parent.postMessage(p, "http://playgame.pps.tv");
                                                                        window.parent.postMessage(p, "http://playgame.iqiyi.com");
                                                                        window.parent.postMessage(p, "http://playgame2.iqiyi.com")
                                                                    })
                                                                } else {
                                                                    if (passType == "GMSER") {
                                                                        document.getElementById("loading").style.display = "block";
                                                                        var openId = orderData.openId;
                                                                        var openKey = orderData.openKey;
                                                                        var param = {};
                                                                        param.openId = openId;
                                                                        param.openKey = openKey;
                                                                        param.appId = appid;
                                                                        param.money = amount;
                                                                        param.appOrderId = orderNo;
                                                                        param.ext = ext;
                                                                        param.data = "";
                                                                        param.appUserName = orderData.appUserName || "玩家";
                                                                        var search = object2search(param);
                                                                        createPay({
                                                                            search: search
                                                                        }, function(data) {
                                                                            BEAR.goToPay(data.appId, data.productId, data.gameUid, data.gameUserName, data.extra)
                                                                        })
                                                                    } else {
                                                                        if (passType == "TIANWSER") {
                                                                            document.getElementById("loading").style.display = "block";
                                                                            var openId = orderData.openId;
                                                                            var openKey = orderData.openKey;
                                                                            var param = {};
                                                                            param.openId = openId;
                                                                            param.openKey = openKey;
                                                                            param.appId = appid;
                                                                            param.money = amount;
                                                                            param.appOrderId = orderNo;
                                                                            param.ext = ext;
                                                                            param.data = "";
                                                                            param.appUserName = orderData.appUserName || "玩家";
                                                                            var search = object2search(param);
                                                                            createPay({
                                                                                search: search
                                                                            }, function(data) {
                                                                                data.appid = gameId;
                                                                                JUHE.pay(data, function(r) {
                                                                                    console.log(r);
                                                                                    var rs = typeof r === "object" ? r : eval("(" + r + ")");
                                                                                    if (rs && rs.err) {
                                                                                        alert("pay called error:充值异常,")
                                                                                    } else {
                                                                                        if (rs && rs.result) {
                                                                                            if (rs.result == "success") {
                                                                                                alert("支付成功")
                                                                                            } else {
                                                                                                if (rs.result == "fail") {
                                                                                                    alert("支付失败")
                                                                                                } else {
                                                                                                    if (rs.result == "cancel") {
                                                                                                        alert("支付取消")
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }, this)
                                                                            })
                                                                        } else {
                                                                            if (passType == "H360SER") {
                                                                                document.getElementById("loading").style.display = "block";
                                                                                var openId = orderData.openId;
                                                                                var openKey = orderData.openKey;
                                                                                var param = {};
                                                                                param.openId = openId;
                                                                                param.openKey = openKey;
                                                                                param.appId = appid;
                                                                                param.money = amount;
                                                                                param.appOrderId = orderNo;
                                                                                param.ext = ext;
                                                                                param.data = "";
                                                                                param.appUserName = orderData.appUserName || "玩家";
                                                                                var search = object2search(param);
                                                                                createPay({
                                                                                    search: search
                                                                                }, function(data) {
                                                                                    document.getElementById("loading").style.display = "none";
                                                                                    H5SDK.setPayTimeOut(function() {
                                                                                        alert("充值超时了")
                                                                                    });
                                                                                    H5SDK.pay(gameId, 1, amount / 100)
                                                                                })
                                                                            } else {
                                                                                if (passType == "LUOBSER") {
                                                                                    document.getElementById("loading").style.display = "block";
                                                                                    var openId = orderData.openId;
                                                                                    var openKey = orderData.openKey;
                                                                                    var param = {};
                                                                                    param.openId = openId;
                                                                                    param.openKey = openKey;
                                                                                    param.appId = appid;
                                                                                    param.money = amount;
                                                                                    param.appOrderId = orderNo;
                                                                                    param.ext = ext;
                                                                                    param.data = "";
                                                                                    param.goodsName = orderData.subject || ((amount == 2800) ? "月卡" : amount / 10 + "元宝");
                                                                                    param.appUserName = orderData.appUserName || "玩家";
                                                                                    var search = object2search(param);
                                                                                    createPay({
                                                                                        search: search
                                                                                    }, function(data) {
                                                                                        document.getElementById("loading").style.display = "none";
                                                                                        pfsdk.pay(data, "", function(result) {
                                                                                            if (result.code == 0) {
                                                                                                toastMsg("充值成功")
                                                                                            } else {
                                                                                                if (result.code == -1) {
                                                                                                    toastMsg("充值取消")
                                                                                                } else {
                                                                                                    toastMsg("充值失败")
                                                                                                }
                                                                                            }
                                                                                            console.log(result)
                                                                                        })
                                                                                    })
                                                                                } else {
                                                                                    if (passType == "YYBYOUGSER") {
                                                                                        document.getElementById("loading").style.display = "block";
                                                                                        var openId = orderData.openId;
                                                                                        var openKey = orderData.openKey;
                                                                                        var param = {};
                                                                                        param.openId = openId;
                                                                                        param.openKey = openKey;
                                                                                        param.appId = appid;
                                                                                        param.money = amount;
                                                                                        param.appOrderId = orderNo;
                                                                                        param.ext = ext;
                                                                                        param.data = "";
                                                                                        var search = object2search(param);
                                                                                        createPay({
                                                                                            search: search
                                                                                        }, function(res) {
                                                                                            GC.yybPay(res);
                                                                                            document.getElementById("loading").style.display = "none"
                                                                                        })
                                                                                    } else {
                                                                                        if (passType == "QUQSER") {
                                                                                            document.getElementById("loading").style.display = "block";
                                                                                            var openId = orderData.openId;
                                                                                            var openKey = orderData.openKey;
                                                                                            var param = {};
                                                                                            param.openId = openId;
                                                                                            param.openKey = openKey;
                                                                                            param.appId = appid;
                                                                                            param.money = amount;
                                                                                            param.appOrderId = orderNo;
                                                                                            param.ext = ext;
                                                                                            param.data = "";
                                                                                            param.goodsName = orderData.subject || "元宝";
                                                                                            param.appUserName = orderData.appUserName || "玩家";
                                                                                            var search = object2search(param);
                                                                                            createPay({
                                                                                                search: search
                                                                                            }, function(res) {
                                                                                                document.getElementById("loading").style.display = "none";
                                                                                                window.PlayGame77163.pay(res.game, res.gamename, res.server, res.user, res.goodsname, res.money, res.gameparam)
                                                                                            })
                                                                                        } else {
                                                                                            if (passType == "ZHIQSER") {
                                                                                                document.getElementById("loading").style.display = "block";
                                                                                                var openId = orderData.openId;
                                                                                                var openKey = orderData.openKey;
                                                                                                var param = {};
                                                                                                param.openId = openId;
                                                                                                param.openKey = openKey;
                                                                                                param.appId = appid;
                                                                                                param.money = amount;
                                                                                                param.appOrderId = orderNo;
                                                                                                param.ext = ext;
                                                                                                param.data = "";
                                                                                                var search = object2search(param);
                                                                                                createPay({
                                                                                                    search: search
                                                                                                }, function(res) {
                                                                                                    document.getElementById("loading").style.display = "none";
                                                                                                    top.location.href = res.payUrl
                                                                                                })
                                                                                            } else {
                                                                                                if (passType == "MEITSER") {
                                                                                                    document.getElementById("loading").style.display = "block";
                                                                                                    var openId = orderData.openId;
                                                                                                    var openKey = orderData.openKey;
                                                                                                    var param = {};
                                                                                                    param.openId = openId;
                                                                                                    param.openKey = openKey;
                                                                                                    param.appId = appid;
                                                                                                    param.money = amount;
                                                                                                    param.appOrderId = orderNo;
                                                                                                    param.ext = ext;
                                                                                                    param.data = "";
                                                                                                    param.subject = orderData.subject || ((amount == 2800) ? "月卡" : amount / 10 + "元宝");
                                                                                                    var search = object2search(param);
                                                                                                    createPay({
                                                                                                        search: search
                                                                                                    }, function(res) {
                                                                                                        document.getElementById("loading").style.display = "none";
                                                                                                        quwanwansdk.pay({
                                                                                                            token: res.token,
                                                                                                            sign: res.sign,
                                                                                                            callFunc: function(status, msg) {
                                                                                                                if (status == "success") {
                                                                                                                    toastMsg("充值成功")
                                                                                                                } else {
                                                                                                                    toastMsg("支付失败：" + msg)
                                                                                                                }
                                                                                                            }
                                                                                                        })
                                                                                                    })
                                                                                                } else {
                                                                                                    if (passType == "YUEWSER") {
                                                                                                        document.getElementById("loading").style.display = "block";
                                                                                                        var openId = orderData.openId;
                                                                                                        var openKey = orderData.openKey;
                                                                                                        var param = {};
                                                                                                        param.openId = openId;
                                                                                                        param.openKey = openKey;
                                                                                                        param.appId = appid;
                                                                                                        param.money = amount;
                                                                                                        param.appOrderId = orderNo;
                                                                                                        param.ext = ext;
                                                                                                        param.data = "";
                                                                                                        param.subject = orderData.subject || ((amount == 2800) ? "月卡" : amount / 10 + "元宝");
                                                                                                        var search = object2search(param);
                                                                                                        createPay({
                                                                                                            search: search
                                                                                                        }, function(res) {
                                                                                                            document.getElementById("loading").style.display = "none";
                                                                                                            top.location.href = res.payUrl
                                                                                                        })
                                                                                                    } else {
                                                                                                        if (passType == "PPTVSER") {
                                                                                                            document.getElementById("loading").style.display = "block";
                                                                                                            var openId = orderData.openId;
                                                                                                            var openKey = orderData.openKey;
                                                                                                            var param = {};
                                                                                                            param.openId = openId;
                                                                                                            param.openKey = openKey;
                                                                                                            param.appId = appid;
                                                                                                            param.money = amount;
                                                                                                            param.appOrderId = orderNo;
                                                                                                            param.ext = ext;
                                                                                                            param.data = "";
                                                                                                            param.subject = orderData.subject || ((amount == 2800) ? "月卡" : amount / 10 + "元宝");
                                                                                                            var search = object2search(param);
                                                                                                            createPay({
                                                                                                                search: search
                                                                                                            }, function(res) {
                                                                                                                document.getElementById("loading").style.display = "none";
                                                                                                                top.location.href = res.payUrl
                                                                                                            })
                                                                                                        } else {
                                                                                                            if (passType == "AIAYSER") {
                                                                                                                document.getElementById("loading").style.display = "block";
                                                                                                                var openId = orderData.openId;
                                                                                                                var openKey = orderData.openKey;
                                                                                                                var param = {};
                                                                                                                param.openId = openId;
                                                                                                                param.openKey = openKey;
                                                                                                                param.appId = appid;
                                                                                                                param.money = amount;
                                                                                                                param.appOrderId = orderNo;
                                                                                                                param.ext = ext;
                                                                                                                param.data = "";
                                                                                                                param.goodsName = orderData.subject || ((amount == 2800) ? "月卡" : amount / 10 + "元宝");
                                                                                                                var search = object2search(param);
                                                                                                                createPay({
                                                                                                                    search: search
                                                                                                                }, function(res) {
                                                                                                                    console.log(res);
                                                                                                                    document.getElementById("loading").style.display = "none";
                                                                                                                    aiaiusdk.pay(res, function(code, msg) {
                                                                                                                        console.log("支付 code=" + code + ",msg=" + msg)
                                                                                                                    })
                                                                                                                })
                                                                                                            } else {
                                                                                                                if (passType == "LAYASER") {
                                                                                                                    document.getElementById("loading").style.display = "block";
                                                                                                                    var openId = orderData.openId;
                                                                                                                    var openKey = orderData.openKey;
                                                                                                                    var param = {};
                                                                                                                    param.openId = openId;
                                                                                                                    param.openKey = openKey;
                                                                                                                    param.appId = appid;
                                                                                                                    param.money = amount;
                                                                                                                    param.appOrderId = orderNo;
                                                                                                                    param.ext = ext;
                                                                                                                    param.data = "";
                                                                                                                    param.goodsName = orderData.subject || ((amount == 2800) ? "月卡" : amount / 10 + "元宝");
                                                                                                                    var search = object2search(param);
                                                                                                                    createPay({
                                                                                                                        search: search
                                                                                                                    }, function(res) {
                                                                                                                        document.getElementById("loading").style.display = "none";
                                                                                                                        pfsdk.recharge(res, function(d) {
                                                                                                                            console.log(d)
                                                                                                                        })
                                                                                                                    })
                                                                                                                } else {
                                                                                                                    console.log("passType", passType)
                                                                                                                }
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    };
    return {
        init: init,
        checkLogin: checkLogin,
        getParameters: getParameters,
        getParameter: getParameter,
        object2search: object2search,
        getDataXHR: getDataXHR,
        loadScript: loadScript,
        getScreenInfo: getScreenInfo,
        login: login,
        toastMsg: toastMsg,
        showConfirm: showConfirm,
        showQrCode: showQrCode,
        citem: getcitem
    }
}();

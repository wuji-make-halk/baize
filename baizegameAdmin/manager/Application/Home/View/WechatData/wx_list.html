<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">

    <!-- <title>基础数据</title> -->
    
    <!--[if lt IE 9]>
    <meta http-equiv="refresh" content="0;ie.html" />
    <![endif]-->

     <!-- 全局CSS1 -->
    <include file="Public:globalCss1"/>

     <link href="__PUBLIC__/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
     

     <!-- 全局CSS2 -->
    <include file="Public:globalCss2"/>
<link href="__PUBLIC__/css/plugins/bootstrap-select-1.13.9/bootstrap-select.min.css" rel="stylesheet">
    
</head>
<style type="text/css">
@media screen and (max-width: 1200px) {
	.switch {
	  position: relative;
	  display: inline-block;
	  width: 60px;
	  height: 34px;
	  top:15px;
	}
}
@media screen and (min-width: 1200px) {
	.switch {
	  position: relative;
	  display: inline-block;
	  width: 60px;
	  height: 34px;
	}
}
	
	
	.switch input {display:none;}
	
	.slider {
	  position: absolute;
	  cursor: pointer;
	  top: 0;
	  left: 0;
	  right: 0;
	  bottom: 0;
	  background-color: #ccc;
	  -webkit-transition: .4s;
	  transition: .4s;
	}
	
	.slider:before {
	  position: absolute;
	  content: "";
	  height: 26px;
	  width: 26px;
	  left: 4px;
	  bottom: 4px;
	  background-color: white;
	  -webkit-transition: .4s;
	  transition: .4s;
	}
	
	input:checked + .slider {
	  background-color: #2196F3;
	}
	
	input:focus + .slider {
	  box-shadow: 0 0 1px #2196F3;
	}
	
	input:checked + .slider:before {
	  -webkit-transform: translateX(26px);
	  -ms-transform: translateX(26px);
	  transform: translateX(26px);
	}
	
	/* Rounded sliders */
	.slider.round {
	  border-radius: 34px;
	}
	
	.slider.round:before {
	  border-radius: 50%;
	}
</style>
<body>         
      <div class="col-xs-12">
          <table data-toggle="table"   data-mobile-responsive="true">
              <thead>
                  <tr>
                      <th>id</th>
                      <th>产品</th>
                      <th>游戏开关</th>
                      <th>是否开放白名单</th>
                  </tr>
              </thead>
              <tbody>
                  <?php foreach($list as $k=>$v){ ?>
                  <tr>
                      <td>{:$v['mini_id']} </td>
                      <td>{:$v['mini_name']} </td>
                      <td>
	                      <label class="switch">
							  <input id="switch_{$k}" type="checkbox" <if condition="$v['switch'] eq 'on'">checked value="on"<else/>value="off"</if> onclick="Getswitch({$v['mini_id']},{$k})">
							  <div class="slider round"></div>
						  </label>
					  </td>
					  <td>
	                      <label class="switch">
							  <input id="switchIp_{$k}" type="checkbox" <if condition="$v['switchIp'] eq 'on'">checked value="on"<else/>value="off"</if> onclick="GetswitchIp({$v['mini_id']},{$k})">
							  <div class="slider round"></div>
						  </label>
					  </td>
                  </tr>
                  <?php } ?>
              </tbody>
          </table>
          <div class="fixed-table-pagination">
              <div class="pull-left pagination-detail">
                  {:$page}    
              </div>
          </div>
      </div>
    <!-- 全局js -->
    
    <include file="Public:globalJs"/>
    <script src="__PUBLIC__/js/plugins/layer/layer.min.js"></script>
    <!-- Bootstrap table -->
    <script src="__PUBLIC__/js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="__PUBLIC__/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script>
    <script src="__PUBLIC__/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>

    <!-- 日期选择器 -->
     <script src="__PUBLIC__/js/plugins/laydate/laydate.js"></script>
    <!-- 日期选择器结束 -->
    <!--解决ios打开iframe 宽大问题-->
    <script type="text/javascript">
        if( /iPhone/i.test(navigator.userAgent) ){
            $('body').width(parent.window.document.body.offsetWidth);
        }
        
    </script>
    <!--解决结束-->
    <!--下拉选择器插件-->
    <script src="__PUBLIC__/js/plugins/bootstrap-select-1.13.9/bootstrap-select.min.js"></script>
    <script type="text/javascript">
            $('.pagination li').click(function(){       //分页转圈操作伪响应
                    if(($(this).attr('class')!="active")&&($(this).attr('class')!="disabled")){
                        layer.load();
                    }
            })
            
            //自适应 下拉选择框
            if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent) ) {
                var ismobile = true      
              }
                <?php if($_GET['product']){ ?>
                  $('select[name=product]').selectpicker('val', "{:$_GET['product']}");
                <?php } ?> 

                $('.mySelect').selectpicker({
                     actionsBox:true,
                     selectAllText:'全选',
                     deselectAllText:'取消全选',
                     liveSearch:true,
                     mobile:ismobile
                });
                //时间选择器
                laydate.render({
                        elem: '.layer-date', //指定元素
                        range: '到'
                    });
                //下拉联动以及加载预选
            $('select[name=product]').on('changed.bs.select loaded.bs.select',function(e){
                $('select[name="channel[]"]').html('');
                $.post('{:U('WechatData/get_mini_appid_channel')}',{appid:$(this).val()},function(data){
                    for(var i in data.info){
                        $('select[name="channel[]"]').append("<option value=" + data.info[i] + ">" + data.info[i] + "</option>");  
                    }
                    <?php if($_GET['channel']){ ?>
                        if(e.type=="loaded"){
                          $('select[name="channel[]"]').selectpicker('val', "{:implode(",", $_GET['channel'])}".split(','));
                        }
                    <?php } ?>
                    $('select[name="channel[]"]').selectpicker('refresh');  
                },'json');
            });
            //更改游戏开关按钮
			function Getswitch(miniId,num){
				var inputValue = document.getElementById('switch_'+num).value;
				if(inputValue=='off'){
					var valueNew = 'on';
				}else{
					var valueNew = 'off';
				}
				$.ajax({
					type:"post",
					url:"{:U('WechatData/wx_list')}",
					data:{inputValue:valueNew,miniId:miniId},
					dataType:"json",
					success:function(data){
						if(data.type=='1'){
							if(document.getElementById('switch_'+num).value=='off'){
								$('[id="switch_'+num+'"]').attr('value', 'on');
								document.getElementById('switch_'+num).checked='checked';
							}else{
								$('[id="switch_'+num+'"]').attr('value', 'off');
								document.getElementById('switch_'+num).checked='';
							}
						}else{
							alert('游戏开关异常，请重新操作！');
						}
					}
				})
			}
			//更改白名单开关按钮
			function GetswitchIp(miniId,num){
				var inputValue = document.getElementById('switchIp_'+num).value;
				if(inputValue=='off'){
					var valueNew = 'on';
				}else{
					var valueNew = 'off';
				}
				$.ajax({
					type:"post",
					url:"{:U('WechatData/wx_list')}",
					data:{inputValueIp:valueNew,miniId:miniId},
					dataType:"json",
					success:function(data){
						if(data.type=='1'){
							if(document.getElementById('switchIp_'+num).value=='off'){
								$('[id="switchIp_'+num+'"]').attr('value', 'on');
								document.getElementById('switchIp_'+num).checked='checked';
							}else{
								$('[id="switchIp_'+num+'"]').attr('value', 'off');
								document.getElementById('switchIp_'+num).checked='';
							}
						}else{
							alert('游戏开关异常，请重新操作！');
						}
					}
				})
			}
    </script>   
</body>

</html>
